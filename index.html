<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Night Delivery – Opinie</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";


// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyDqWK9pZt5Ak97-1b12LymEu5bGVLpbPn0",
  authDomain: "night-delivery-18960.firebaseapp.com",
  projectId: "night-delivery-18960",
  storageBucket: "night-delivery-18960.firebasestorage.app",
  messagingSenderId: "425404689430",
  appId: "1:425404689430:web:efce19048bee3232a11937",
  measurementId: "G-C2JG4SVNQQ"
};
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const opinionsRef = collection(db, "opinions");

window.addOpinion = async () => {
const name = document.getElementById("name").value.trim();
const text = document.getElementById("text").value.trim();
const rating = parseInt(document.querySelector("input[name='rating']:checked")?.value);
const tip = parseFloat(document.getElementById("tip").value || 0);

if (!name || !text || !rating) {
alert("Uzupełnij wszystkie wymagane pola!");
return;
}

await addDoc(opinionsRef, {
name,
text,
rating,
tip,
createdAt: serverTimestamp()
});

document.getElementById("form").reset();
};

const q = query(opinionsRef, orderBy("createdAt", "desc"));

onSnapshot(q, (snapshot) => {
const list = document.getElementById("opinions");
list.innerHTML = "";

let sum = 0;
let count = 0;

snapshot.forEach(doc => {
const d = doc.data();
sum += d.rating;
count++;

list.innerHTML += `
<div class="opinion">
<strong>${d.name}</strong>
<div class="stars">${"⭐".repeat(d.rating)}</div>
<p>${d.text}</p>
<small>Napiwek: ${d.tip.toFixed(2)} zł</small>
</div>
`;
});

document.getElementById("avg").innerText =
count ? (sum / count).toFixed(1) : "0.0";
});
</script>

<style>
body {
background: #0f172a;
color: #fff;
font-family: Arial, sans-serif;
padding: 20px;
}
h1 { color: #38bdf8; }
input, textarea, button {
width: 100%;
margin: 6px 0;
padding: 10px;
border-radius: 6px;
border: none;
}
button {
background: #22c55e;
color: #000;
font-weight: bold;
cursor: pointer;
}
.stars label {
cursor: pointer;
font-size: 22px;
}
.opinion {
background: #1e293b;
padding: 12px;
border-radius: 8px;
margin: 10px 0;
}
.regulamin {
background: #020617;
padding: 12px;
margin-top: 20px;
font-size: 13px;
}
</style>
</head>

<body>

<h1>Night Delivery ⭐ <span id="avg">0.0</span></h1>

<form id="form" onsubmit="event.preventDefault(); addOpinion();">
<input id="name" placeholder="Twoje imię" required>

<div class="stars">
<label><input type="radio" name="rating" value="1">⭐</label>
<label><input type="radio" name="rating" value="2">⭐⭐</label>
<label><input type="radio" name="rating" value="3">⭐⭐⭐</label>
<label><input type="radio" name="rating" value="4">⭐⭐⭐⭐</label>
<label><input type="radio" name="rating" value="5">⭐⭐⭐⭐⭐</label>
</div>

<textarea id="text" placeholder="Napisz opinię..." required></textarea>

<input id="tip" type="number" min="0" step="0.01" placeholder="Napiwek (zł) – opcjonalnie">

<button>Dodaj opinię</button>
</form>

<div id="opinions"></div>

<div class="regulamin">
<h3>Regulamin</h3>
<p>
Opinie są publiczne i widoczne dla wszystkich użytkowników.
Zabronione jest dodawanie treści obraźliwych, niezgodnych z prawem
lub zawierających dane osobowe osób trzecich.
Administracja zastrzega sobie prawo do usuwania opinii.
Napiwek jest dobrowolny i nie podlega zwrotowi.
</p>
</div>

</body>
</html>











